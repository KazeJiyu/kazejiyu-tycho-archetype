# Tycho Archetype

[![Build Status](https://travis-ci.org/KazeJiyu/kazejiyu-tycho-archetype.svg?branch=master)](https://travis-ci.org/KazeJiyu/kazejiyu-tycho-archetype) [ ![Download](https://api.bintray.com/packages/kazejiyu/kazejiyu-tycho-archetype/kazejiyu-tycho-archetype/images/download.svg) ](https://bintray.com/kazejiyu/kazejiyu-tycho-archetype/kazejiyu-tycho-archetype/_latestVersion)

A [Maven Archetype](https://maven.apache.org/guides/introduction/introduction-to-archetypes.html) that can be used to generate the architecture of a [Tycho](https://www.eclipse.org/tycho/) project.

## Sample project 

This repository contains a [sample project](src/test/resources/projects/piou/reference) that can be looked up to see how a project generated by this archetype looks like.

## Usage

As any other archetype, the Tycho Archetype can be used from the command line. It is identified by the following properties:

| Property | Value |
| :---         |     :---:      |  
| Group ID | `fr.kazejiyu.maven.archetypes` |  
| Artifact ID | `kazejiyu-tycho-archetype` |  
| Version | (see Bintray badge above) |  

Type the following command to use the archetype and to start the generation of a new project:
```
mvn archetype:generate -DarchetypeGroupId=fr.kazejiyu.maven.archetypes -DarchetypeArtifactId=kazejiyu-tycho-archetype -DarchetypeRepository=https://dl.bintray.com/kazejiyu/maven
```

> You can alternatively clone this repository then install the archetype in your local installation by typing `mvn install`

## Generated files

The archetype follows [Lars Vogel advices](http://www.vogella.com/tutorials/EclipseTycho/article.html) on how a Tycho project should be structured. More specifically, it generates the following architecture:

```
│   pom.xml
│
├───.mvn
│       extensions.xml
│
├───bundles
│       pom.xml
│
├───features
│       pom.xml
│
├───releng
│   │   pom.xml
│   │
│   ├───<artifactId>.releng.configuration
│   │       .project
│   │       pom.xml
│   │
│   ├───<artifactId>.releng.p2
│   │       .project
│   │       category.xml
│   │       pom.xml
│   │
│   └───<artifactId>.releng.targetplatform
│           .project
│           <artifactId>.releng.targetplatform.target
│           pom.xml
│
└───tests
        pom.xml
```

## Use the generated project

### Table of Contents

- [Build the project](#build-the-project)
- [Create a plug-in](#create-a-plug-in)
- [Create a test plug-in](#create-a-test-plug-in)
- [Create a feature](#create-a-feature)
- [Configurate the dependencies](#configurate-the-dependencies)
- [Generate an update site](#generate-an-update-site)

### Build the project

The generated project can be built with Maven via `mvn clean package`.

### Create a plug-in

#### Location

All the plug-ins should be located under the `bundles/` folder. For instance, adding a `fr.kazejiyu.piou.core` plug-in to the project would result in the following tree structure:

```
.
├───bundles
│   │   pom.xml
│   └───fr.kazejiyu.piou.core
│       │   .classpath
│       │   .project
│       │   build.properties
│       ├───.settings
│       │       org.eclipse.jdt.core.prefs
│       ├───bin
│       ├───META-INF
│       │       MANIFEST.MF
│       └───src
```

#### Add to Maven build

In order to be taken into account by Maven, the plug-in must be added as a sub-module of the _bundles_ module. To this end, the _bundles/pom.xml_ must be enhanced with a `<module>` tag as follows:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	
	<groupId>fr.kazejiyu.piou</groupId>
	<artifactId>fr.kazejiyu.piou.bundles</artifactId>
	<version>1.0.0-SNAPSHOT</version>
	<packaging>pom</packaging>
	
        ...
        
        <modules>
                <module>fr.kazejiyu.piou.core</module>
        </modules>    
</project>
```

### Create a test plug-in

#### Location

All the test plug-ins should be located under the `tests/` folder. For instance, adding a `fr.kazejiyu.piou.core.tests` plugin-in to the project would result in the following tree structure:

```
.
└───tests
    │   pom.xml
    └───fr.kazejiyu.piou.core.tests
        │   .classpath
        │   .project
        │   build.properties
        │   pom.xml
        ├───.settings
        │       org.eclipse.jdt.core.prefs
        ├───META-INF
        │       MANIFEST.MF
``` 

#### Add to Maven build

In order to be taken into account by Maven, the plug-in must be added as a sub-module of the _features_ module. To this end, the _features/pom.xml_ must be enhanced with a `<module>` tag as follows:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	
	<groupId>fr.kazejiyu.piou</groupId>
	<artifactId>fr.kazejiyu.piou.tests</artifactId>
	<version>1.0.0-SNAPSHOT</version>
	<packaging>pom</packaging>
	
        ...
        
        <modules>
                <module>fr.kazejiyu.piou.core.tests</module>
        </modules>    
</project>
```

Moreover, a _pom.xml_ must be added to the `fr.kazejiyu.piou.core.tests` folder ; its aim is to indicate to Tycho that the plug-in holds tests. This file looks like:

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>
    <groupId>fr.kazejiyu.piou</groupId>
    <artifactId>fr.kazejiyu.piou.core.tests</artifactId>
    <packaging>eclipse-test-plugin</packaging>

	<parent>
		<groupId>fr.kazejiyu.piou</groupId>
		<artifactId>fr.kazejiyu.piou.tests</artifactId>
		<version>1.0.0-SNAPSHOT</version>
	</parent>
</project>
```

> **Note**: the import thing here is the _eclipse-test-plugin_ packaging.

#### Execute the tests

The tests can be executed with `mvn verify`.

> **/!\ Caution**: don't forget to add the `org.junit` and its dependencies to the target platform, otherwise the Maven build will fail. JUnit plug-ins can be found in the [Orbit repository](http://download.eclipse.org/tools/orbit/downloads/).

### Create a feature

#### Location

All the features should be located under the `features/` folder. For instance, adding a `fr.kazejiyu.piou.feature` plug-in to the project would result in the following tree structure:

```
.
├───features
│   │   pom.xml
│   └───fr.kazejiyu.piou.feature
│           .project
│           build.properties
│           feature.xml
```

#### Add to Maven build

In order to be taken into account by Maven, the plug-in must be added as a sub-module of the _features_ module. To this end, the _features/pom.xml_ must be enhanced with a `<module>` tag as follows:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	
	<groupId>fr.kazejiyu.piou</groupId>
	<artifactId>fr.kazejiyu.piou.features</artifactId>
	<version>1.0.0-SNAPSHOT</version>
	<packaging>pom</packaging>
	
        ...
        
        <modules>
                <module>fr.kazejiyu.piou.feature</module>
        </modules>    
</project>
```

### Configurate the dependencies

The dependencies of a project should be managed through the use of a [target platform](http://www.vogella.com/tutorials/EclipseTargetPlatform/article.html). The archetype automatically generates an empty one called:

- `releng/<artifactId>.releng.targetplatform/<artifactId>.releng.targetplatform.target`.

Since Tycho uses this target platform to configure Maven build, you should update this file each time your project requires a new dependency.

### Generate an update site

Through [p2 update sites](http://www.vogella.com/tutorials/EclipseP2Update/article.html), you can provide your users an easy way to download your plug-ins. The archetype automatically defines an empty one with:

- `releng/<artifactId>.releng.p2/category.xml`.

This file can be modified from Eclipse IDE in order to add new features to the update site.

The command `mvn package` then generates a functional update site in:

- `releng/<artifactId>.releng.p2/target/repository`
